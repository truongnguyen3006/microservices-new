spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/order-service
spring.datasource.username=root
spring.datasource.password=
spring.jpa.hibernate.ddl-auto=update

server.port=0
spring.application.name=order-service
eureka.client.service-url.defaultZone=http://eureka:password@localhost:8761/eureka/

# Mỗi instance có ID duy nhất, tránh bị ghi đè
eureka.instance.instance-id=${spring.application.name}:${spring.cloud.client.hostname}:${server.port}:${random.uuid}

spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.consumer.group-id=order-updater-group
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=io.confluent.kafka.serializers.json.KafkaJsonSchemaSerializer
spring.kafka.producer.properties.schema.registry.url=http://localhost:8081

spring.datasource.hikari.maximum-pool-size=100
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.max-lifetime=1800000

# === KAFKA PRODUCER HIGH-THROUGHPUT SETTINGS ===

# 1. Tăng "bể chứa" (buffer) từ 32MB lên 64MB
# Cho phép chứa nhiều message đang chờ gửi hơn
spring.kafka.producer.properties.buffer.memory=67108864

# 2. "Xe buýt" (Linger) - CỰC KỲ QUAN TRỌNG
# Thay vì gửi message ngay lập tức (0ms), hãy đợi 5ms
# để gom nhiều message lại thành 1 "lô" (batch) rồi gửi
# Điều này giảm tải mạng và tăng thông lượng cực lớn
spring.kafka.producer.properties.linger.ms=5

# 3. Kích thước "xe buýt" (Batch Size)
# Tăng kích thước lô tối đa từ 16KB lên 64KB
spring.kafka.producer.properties.batch.size=65536

# 4. Nén dữ liệu
# Giảm kích thước dữ liệu gửi qua mạng. Snappy rất nhanh.
spring.kafka.producer.properties.compression.type=snappy

# 1. Bắn và Quên (Acks = 0)
# Producer sẽ KHÔNG CHỜ broker xác nhận. Nó ném message qua mạng và ngay lập tức
# coi như "thành công". Đây là tốc độ nhanh nhất tuyệt đối.
spring.kafka.producer.properties.acks=0

# 2. Không bao giờ Block (max.block.ms = 0)
# Nếu buffer của producer đầy, thay vì chờ (block) luồng HTTP,
# nó sẽ ngay lập tức ném ra lỗi BufferExhaustedException (bên trong hàm whenComplete)
spring.kafka.producer.properties.max.block.ms=1000

# === SỬA LỖI SCHEMA.REGISTRY.URL ===
# Cho phép tự động đăng ký schema mới
spring.kafka.producer.properties.auto.register.schemas=true

# Tăng số luồng worker (làn xe) từ 200 (mặc định) lên 1000
server.tomcat.threads.max=1000
# Tăng hàng đợi (chỗ xếp hàng) từ 100 (mặc định) lên 1000
server.tomcat.accept-count=1000

