# cung cap dia chi cua may chu Eureka (Discovery Server) de no co the tu dang ky
eureka.client.serviceUrl.defaultZone=http://eureka:password@localhost:8761/eureka
spring.application.name=api-gateway
server.port=8080
eureka.instance.instance-id=${spring.application.name}:${spring.cloud.client.hostname}:${server.port}:${random.uuid}
eureka.instance.prefer-ip-address=true

logging.level.org.springframework.cloud.gateway.route.RouteDefinitionLocator = INFO
logging.level.org.springframework.cloud.gateway = TRACE

## Product Service Route
spring.cloud.gateway.server.webflux.routes[0].id=product-service
spring.cloud.gateway.server.webflux.routes[0].uri=lb://product-service
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/api/product/**

## Order Service Route
spring.cloud.gateway.server.webflux.routes[1].id=order-service
spring.cloud.gateway.server.webflux.routes[1].uri=lb://order-service
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/api/order/**, /error/**

## Discover Server Route
spring.cloud.gateway.server.webflux.routes[2].id=discovery-server
spring.cloud.gateway.server.webflux.routes[2].uri=http://localhost:8761
spring.cloud.gateway.server.webflux.routes[2].predicates[0]=Path=/eureka/web
# Gateway Filter cho phep ban sua doi yeu cau (request) HTTP truoc khi no duoc chuyen den dich vu dich
spring.cloud.gateway.server.webflux.routes[2].filters[0]=SetPath=/

## User Service Route
spring.cloud.gateway.server.webflux.routes[3].id=user-service
spring.cloud.gateway.server.webflux.routes[3].uri=lb://user-service
spring.cloud.gateway.server.webflux.routes[3].predicates[0]=Path=/api/user/**, /auth/**, /api/admin/**


## Discover Server Route Static Resources Route
spring.cloud.gateway.server.webflux.routes[4].id=discovery-server-static
spring.cloud.gateway.server.webflux.routes[4].uri=http://localhost:8761
spring.cloud.gateway.server.webflux.routes[4].predicates[0]=Path=/eureka/**

spring.cloud.gateway.server.webflux.routes[5].id=payment-service
spring.cloud.gateway.server.webflux.routes[5].uri=lb://payment-service
spring.cloud.gateway.server.webflux.routes[5].predicates[0]=Path=/api/payment/**

spring.cloud.gateway.server.webflux.routes[6].id=inventory-service
spring.cloud.gateway.server.webflux.routes[6].uri=lb://inventory-service
spring.cloud.gateway.server.webflux.routes[6].predicates[0]=Path=/api/inventory/**

spring.cloud.gateway.server.webflux.routes[7].id=cart-service
spring.cloud.gateway.server.webflux.routes[7].uri=lb://cart-service
spring.cloud.gateway.server.webflux.routes[7].predicates[0]=Path=/api/cart/**



spring.security.oauth2.resourceserver.jwt.issuer-uri=http://keycloak:8085/realms/spring-boot-microservices-realm

logging.level.org.springframework.cloud.loadbalancer=INFO
logging.level.reactor.netty.http.client=INFO

spring.cloud.loadbalancer.cache.enabled=false

# 2. (Khuyến nghị) Buộc gateway làm mới danh sách từ Eureka
# 5 giây một lần (mặc định là 30 giây)
eureka.client.registry-fetch-interval-seconds=5

# ==========================================================
# SỬA LỖI: Dùng key (khóa) Spring Boot chính xác
# ==========================================================
spring.reactor.netty.io-worker-count=8

# ==== NETTY TUNING (HTTP CLIENT - Gọi đi) ====
spring.cloud.gateway.server.webflux.httpclient.pool.max-connections=2000
spring.cloud.gateway.server.webflux.httpclient.pool.acquire-timeout=10000
spring.cloud.gateway.server.webflux.httpclient.connect-timeout=10000
spring.cloud.gateway.server.webflux.httpclient.response-timeout=30s


spring.cloud.gateway.server.webflux.httpclient.pool.eviction-interval=30s
spring.cloud.gateway.server.webflux.httpclient.pool.max-idle-time=30s

spring.cloud.gateway.server.webflux.httpclient.pool.type=fixed

# ==== NETTY TUNING (HTTP SERVER - Nhận vào) ====
server.netty.max-initial-line-length=65536
server.max-http-request-header-size=65536
server.netty.validate-headers=false

# ==== RATE LIMIT / BACKPRESSURE ====
# Tắt Rate Limiter (bộ lọc) để test
spring.cloud.gateway.server.webflux.filter.request-rate-limiter.enabled=false


server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain
server.compression.min-response-size=1024

logging.level.root=WARN